#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "Menu.h"
#include "Validation.h"


/**
 * @brief measure the length of a chain
 *
 * @param string char
 * @param length int pointer
 * @return	Return (-1) if [Invalid length or NULL pointer] - if (0) OK
 */
int measureLength(char string[], int* length)
{
	int report = -1;

		if(string != NULL && length > 0)
		{
			report = 0;

			(*length) = strlen(string);

		}

	return report;
}

int validateLength(char* chains, int len)
{
	int report = -1;
	int length;

		if(chains != NULL && len > 0)
		{
			report = 0;

			length = strlen(chains);

				if(length < len)
				{
					report = 0;
				}
				else
				{
					report = 1;
				}

		}

	return report;
}

int validateOnlyLetters(char* chains, int len)
{
	int report = -1;
	int i;

		if(chains != NULL && len > 0)
		{
			report = 0;
			for(i=0;i<len;i++)
			{
				if((chains[i] < 65 || chains[i] > 90) && (chains[i] < 97 || chains[i] > 122))
				{
					report = 1;
					break;
				}
			}
		}

	return report;
}


int getNameOrLastName(char* pResult, int len, char* message, char* messageError, int Attempts)
{
	int report = -1;
	int reportLetters;
	int reportLength;
	char buffer[4096];

	int lenght;

		if(pResult != NULL && len > 0 && message != NULL && messageError != NULL && Attempts > 0)
		{
			while(Attempts >= 0)
			{
				report = 1;

				Attempts--;

					printf("%s", message);
						fflush(stdin);
						gets(buffer);

						measureLength(buffer, &lenght);

						reportLength = validateLength(buffer, len);
						reportLetters = validateOnlyLetters(buffer, lenght);

						if(reportLetters == 0 && reportLength == 0)
						{
							report = 0;
							strncpy(pResult, buffer, len);
							break;
						}
						else
						{
							printf("%s\n", messageError);
						}
			}

		}

	return report;
}

int getNumberTypeFloat(float* number, char* message, char*messageError, float min, float max, int Attempts)
{
	int report = -1;
	char numberFloat[4096];
	int reportFloat;
	int lenght;
	float NumConverted;

		if(min > 0.01 && max < 10000000 && message != NULL && messageError != NULL && Attempts > 0)
		{
			report = 1;

				while(Attempts>=0)
				{
					Attempts--;

					printf("%s", message);
						fflush(stdin);
						gets(numberFloat);

					measureLength(numberFloat, &lenght);

					reportFloat = validateNumberFloat(numberFloat, lenght);

					NumConverted = atof(numberFloat);

						if(reportFloat == 0 && NumConverted > min && NumConverted < max)
						{
							report = 0;
							*number = NumConverted;
							break;
						}

				}
		}

	return report;
}

int validateNumberFloat(char* buffer, int len)
{
	int report = -1;
	int i;
	int bandera=0;

		if(buffer != NULL && len > 0)
		{
			report = 0;
			for(i=0;i<len;i++)
			{
				if((buffer[i] != 46) && (buffer[i] < 48 || buffer[i] > 57))
				{
					report = 1;
					break;
				}
				if(bandera == 0 && buffer[i] == 46)
				{
					bandera=1;
				}
				else
				{
					if(buffer[i] == 46 && bandera == 1)
					{
						report = 1;
						break;
					}

				}

			}

		}

	return report;
}

int validateOnlyLettersAndNumbers(char* chains, int len)
{
	int report = -1;
	int i;

		if(chains != NULL && len > 0)
		{
			report = 0;
			for(i=0;i<len;i++)
			{
				if(((chains[i] < 48 || chains[i] > 57) && (chains[i] < 65 || chains[i] > 90)) && ( chains[i] < 97 || chains[i] > 122))
				{
					report = 1;
					break;
				}
			}
		}

	return report;
}


int getNumberAlphanumeric(char* alphaNumeic, int len, char* message, char*messageError, int attempts)
{
	int report = -1;
	char buffer[4096];
	int reportLength;
	int reportLetterNumbers;
	int lenght;

		if(alphaNumeic != NULL && len > 0 && message != NULL && attempts > 0)
		{
			report = 1;

				while(attempts >= 0)
				{
					attempts--;

					printf("%s", message);
						fflush(stdin);
						gets(buffer);

					measureLength(buffer, &lenght);

					reportLength = validateLength(buffer, len);
					reportLetterNumbers = validateOnlyLettersAndNumbers(buffer, lenght);

						if(reportLength == 0 && reportLetterNumbers == 0 )
						{
							strcpy(alphaNumeic, buffer);
							report = 0;
							break;
						}
				}


		}

	return report;
}

int validateNumberInt(char* buffer, int lenght)
{
	int report = -1;
	int i;

		if(buffer != NULL && lenght > 0)
		{
			report = 0;

			for(i=0;i<lenght;i++)
			{
				if(buffer[i] < 48 || buffer[i] > 57)
				{
					report = 1;
					break;
				}
			}

		}

	return report;
}


int getNumberTypeInt(int* number, char* message, char* messageError, int min, int max,  int Attempts)
{
	int report = -1;
	char buffer[4096];
	int lenght;
	int reportNumber;
	int NumConverted;

		if(min >= 0 && max < 1000000 && message != NULL && messageError != NULL && Attempts > 0)
		{
				while(Attempts >= 0)
				{
					report = 1;

					Attempts--;

					printf("%s", message);
					fflush(stdin);
					gets(buffer);

					measureLength(buffer, &lenght);

					reportNumber = validateNumberInt(buffer, lenght);

					NumConverted = atoi(buffer);

						if(reportNumber == 0 && NumConverted > min && NumConverted < max)
						{
							report = 0;
							*number = NumConverted;
							break;
						}
						else
						{
							printf("%s\n", messageError);
						}
				}

		}

	return report;
}

int assignId(int** counterId, int* id)
{
	int report = -1;
	int counter;

		if(counterId >= 0)
		{
			report = 0;

			counter = **counterId;
			counter++;

			(**counterId) = counter;
			(*id) = counter;

		}

	return report;
}

